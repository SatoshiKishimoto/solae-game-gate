<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Solae Game Gate</title>

  <!-- SEO / OGPï¼ˆå¿…è¦ãªã‚‰ç”»åƒURLå·®ã—æ›¿ãˆï¼‰ -->
  <meta name="description" content="Solaeå…¬å¼ãƒŸãƒ‹ã‚²ãƒ¼ãƒ é›†ã€‚åºƒå‘Šè¡¨ç¤ºå¾Œã«ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã¾ã™ã€‚ã‚¹ãƒãƒ›å¯¾å¿œã€‚" />
  <meta property="og:title" content="Solae Game Gate" />
  <meta property="og:description" content="Solaeå…¬å¼ãƒŸãƒ‹ã‚²ãƒ¼ãƒ é›†ã€‚åºƒå‘Šè¡¨ç¤ºå¾Œã«ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã¾ã™ã€‚" />
  <meta property="og:type" content="website" />

  <style>
    :root{--bg:#0b0f1a;--card:#121a2b;--text:#fff;--muted:#aab3d6;--blue:#2563eb;--danger:#ff5c5c}
    body{margin:0;font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:grid;place-items:center}
    .wrap{width:min(520px,92vw);padding:18px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
    .logoLink{display:inline-flex;align-items:center;gap:10px;text-decoration:none}
    .logo{height:34px;display:block;object-fit:contain;filter:drop-shadow(0 2px 6px rgba(0,0,0,.35))}
    .brand{font-weight:900;letter-spacing:.3px}
    .box{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.10);border-radius:18px;padding:16px 14px;box-shadow:0 16px 40px rgba(0,0,0,.30)}
    h2{margin:0 0 6px;font-size:18px}
    p{margin:0 0 14px;color:var(--muted);font-size:13px;line-height:1.6}
    #ad-area{min-height:120px;border-radius:14px;background:rgba(255,255,255,.06);border:1px dashed rgba(255,255,255,.18);
             display:flex;align-items:center;justify-content:center;color:#7b86b3;font-weight:800;margin:10px 0 14px; padding:10px; text-align:center}
    #count{font-size:46px;font-weight:1000;text-align:center;margin:10px 0 12px}
    .btn{width:100%;border:0;border-radius:14px;padding:14px 16px;font-size:16px;font-weight:1000;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,#3b82f6,var(--blue));color:#fff}
    .btn.secondary{background:rgba(255,255,255,.08);color:#fff;border:1px solid rgba(255,255,255,.12);margin-top:10px}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .hint{margin-top:10px;color:var(--muted);font-size:12px;text-align:center}
    .hide{display:none}
    .err{color:var(--danger);font-weight:900;font-size:12px;margin-top:10px;line-height:1.5}
    .small{font-size:12px;color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row .btn{flex:1}
    code{background:rgba(255,255,255,.06);padding:2px 6px;border-radius:8px}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <!-- âœ… ãƒ­ã‚´ã«ãƒªãƒ³ã‚¯ï¼ˆSolaeã‚µã‚¤ãƒˆã¸ï¼‰ -->
      <a class="logoLink" href="https://solae.my.canva.site/" target="_blank" rel="noopener">
        <img class="logo" src="https://lh3.googleusercontent.com/d/1ejao3rdNer6UppKTaAAFlC3ILTR0RcUP" alt="Solae">
        <div class="brand">Solae</div>
      </a>
      <div style="font-size:12px;color:var(--muted)">Game Gate</div>
    </div>

    <div class="box">
      <h2>ğŸ® ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹å‰ã«â€¦</h2>
      <p>ä¸‹ã®è¡¨ç¤ºãŒçµ‚ã‚ã£ãŸã‚‰ã€Œã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹ã€ãŒæŠ¼ã›ã¾ã™ã€‚</p>

      <!-- âœ… ã“ã“ã«åºƒå‘Šã‚¿ã‚°ã‚’è²¼ã‚‹ï¼ˆå¿…è¦ãªã‚‰ï¼‰ -->
      <div id="ad-area">
        åºƒå‘Šã‚¨ãƒªã‚¢ï¼ˆã“ã“ã«ã‚¿ã‚°ï¼‰<br>
        <span class="small">â€»ã‚¿ã‚°ã‚’å…¥ã‚Œãªã„å ´åˆã‚‚å‹•ä½œã—ã¾ã™</span>
      </div>

      <div id="count">5</div>

      <button id="go" class="btn primary hide">â–¶ ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹</button>

      <div class="row">
        <button id="back" class="btn secondary">â† æˆ»ã‚‹</button>
        <button id="copy" class="btn secondary">ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
      </div>

      <div id="err" class="err hide"></div>

      <div class="hint">
        â€»URLç›´æ‰“ã¡å¯¾ç­–ã‚’å¼·åŒ–ã—ãŸã„å ´åˆã¯æ¬¡ã«ã€Œãƒˆãƒ¼ã‚¯ãƒ³æ–¹å¼ã€ã«é€²ã‚ã¾ã™ã€‚
      </div>
    </div>
  </div>

  <script>
    // =============================
    // è¨­å®šï¼šè¨±å¯ã™ã‚‹é·ç§»å…ˆãƒ‰ãƒ¡ã‚¤ãƒ³
    // =============================
    const ALLOWED_HOSTS = new Set([
      'script.google.com',
      'script.googleusercontent.com'
      // å¿…è¦ãªã‚‰ã“ã“ã«è¿½åŠ :
      // 'example.com'
    ]);

    // Gateã®ãƒˆãƒƒãƒ—ï¼ˆæˆ»ã‚‹ç”¨ã®fallbackï¼‰
    const GATE_HOME = 'https://satoshikishimoto.github.io/solae-game-gate/';

    const params = new URLSearchParams(location.search);
    const rawTo = params.get('to');

    const goBtn = document.getElementById('go');
    const countEl = document.getElementById('count');
    const errEl = document.getElementById('err');
    const backBtn = document.getElementById('back');
    const copyBtn = document.getElementById('copy');

    function showError(msg){
      errEl.textContent = msg;
      errEl.classList.remove('hide');
      countEl.textContent = 'â€”';
      countEl.style.opacity = .5;
      goBtn.classList.add('hide');
    }

    // 2é‡/3é‡ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ã»ã©ãï¼ˆæœ€å¤§3å›ï¼‰
    function deepDecode(s){
      let out = (s ?? '').toString().trim();
      // å…ˆé ­æœ«å°¾ã® " ' ã‚’é™¤å»
      out = out.replace(/^["']|["']$/g, '');
      for (let i = 0; i < 3; i++){
        try{
          const dec = decodeURIComponent(out);
          if (dec === out) break;
          out = dec;
        }catch(e){
          break;
        }
      }
      return out.trim();
    }

    // URLæ¤œè¨¼ + è¨±å¯ãƒ‰ãƒ¡ã‚¤ãƒ³
    function validateAndNormalize(urlStr){
      const u = new URL(urlStr);
      if (u.protocol !== 'https:' && u.protocol !== 'http:') {
        throw new Error('URLãŒ http/https ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
      }
      if (!ALLOWED_HOSTS.has(u.hostname)) {
        throw new Error('è¨±å¯ã•ã‚Œã¦ã„ãªã„é·ç§»å…ˆã§ã™ã€‚');
      }
      return u.toString();
    }

    // æˆ»ã‚‹ï¼šhistory ãŒåŠ¹ã‹ãªã„å ´åˆã® fallback
    backBtn.addEventListener('click', () => {
      // referrerãŒåŒä¸€ã‚ªãƒªã‚¸ãƒ³ã§ãªãã¦ã‚‚æˆ»ã‚Œã‚‹ãŒã€ç„¡ã„å ´åˆã¯fallback
      if (history.length > 1) history.back();
      else location.href = GATE_HOME;
    });

    // ã‚³ãƒ”ãƒ¼ï¼šç¾åœ¨ã®URLï¼ˆ=ã‚·ã‚§ã‚¢ç”¨ï¼‰
    copyBtn.addEventListener('click', async () => {
      try{
        await navigator.clipboard.writeText(location.href);
        copyBtn.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
        setTimeout(() => copyBtn.textContent = 'ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼', 1100);
      }catch(e){
        copyBtn.textContent = 'ã‚³ãƒ”ãƒ¼å¤±æ•—';
        setTimeout(() => copyBtn.textContent = 'ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼', 1100);
      }
    });

    // =============================
    // ãƒ¡ã‚¤ãƒ³å‡¦ç†
    // =============================
    if (!rawTo){
      showError('é·ç§»å…ˆãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆURLã® ?to= ãŒã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚');
    } else {
      let dest = null;
      try{
        const decoded = deepDecode(rawTo);
        dest = validateAndNormalize(decoded);
      } catch(e){
        showError('ãƒªãƒ³ã‚¯ãŒä¸æ­£ã§ã™ï¼š' + (e?.message || String(e)) + '\n' +
          'ä¾‹ï¼š' + ' ' + '?to=' + encodeURIComponent('https://script.google.com/macros/s/XXXXX/exec'));
      }

      if (dest){
        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
        let sec = 5;
        countEl.textContent = String(sec);

        const t = setInterval(() => {
          sec--;
          countEl.textContent = String(sec);
          if (sec <= 0) {
            clearInterval(t);
            countEl.classList.add('hide');
            goBtn.classList.remove('hide');
            goBtn.disabled = false;
          }
        }, 1000);

        goBtn.addEventListener('click', () => {
          // ã“ã“ã¯ location.href ã®ã¾ã¾ã§OKï¼ˆåŒä¸€ã‚¿ãƒ–é·ç§»ï¼‰
          location.href = dest;
        }, { once:true });
      }
    }
  </script>
</body>
</html>

  <!-- âœ… ã“ã“ã«åºƒå‘Šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã® script ã‚’è²¼ã‚‹ï¼ˆä¾‹ï¼šMonetagç­‰ï¼‰ -->
  <!-- <script src="..."></script> -->
</body>
</html>
